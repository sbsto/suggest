#!/usr/bin/env bash
set -euo pipefail

# Install script for suggest tool
# This script installs the suggest binary to the specified path

# Ensure required environment variables are set
if [[ -z "${ASDF_INSTALL_VERSION:-}" ]]; then
    echo "Error: ASDF_INSTALL_VERSION is not set" >&2
    exit 1
fi

if [[ -z "${ASDF_INSTALL_PATH:-}" ]]; then
    echo "Error: ASDF_INSTALL_PATH is not set" >&2
    exit 1
fi

version="$ASDF_INSTALL_VERSION"
install_path="$ASDF_INSTALL_PATH"

# Create bin directory in install path
mkdir -p "$install_path/bin"

# Determine the correct binary name based on platform
case "$(uname -s)" in
    Darwin)
        platform="darwin"
        ;;
    Linux)
        platform="linux"
        ;;
    *)
        echo "Error: Unsupported platform $(uname -s)" >&2
        exit 1
        ;;
esac

case "$(uname -m)" in
    x86_64)
        arch="amd64"
        ;;
    aarch64|arm64)
        arch="arm64"
        ;;
    *)
        echo "Error: Unsupported architecture $(uname -m)" >&2
        exit 1
        ;;
esac

# Download the binary from GitHub releases
binary_name="suggest-${platform}-${arch}"
download_url="https://github.com/sbsto/suggest/releases/download/${version}/${binary_name}"

echo "Downloading suggest ${version} for ${platform}/${arch}..."
curl -fsSL "$download_url" -o "$install_path/bin/suggest"

# Make the binary executable
chmod +x "$install_path/bin/suggest"

echo "suggest ${version} installed successfully to $install_path/bin/suggest"